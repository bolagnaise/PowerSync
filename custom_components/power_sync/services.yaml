# Services for PowerSync integration
sync_tou_schedule:
  name: Sync TOU Schedule
  description: Manually trigger a sync of Time-of-Use schedule from Amber to Tesla
  fields: {}

sync_now:
  name: Sync Now
  description: Immediately refresh data from Amber and Tesla
  fields: {}

force_discharge:
  name: Force Discharge
  description: Force battery discharge mode - switches to autonomous with high export tariff to maximise export
  fields:
    duration:
      name: Duration
      description: Duration in minutes (15, 30, 45, 60, 75, 90, 105, or 120)
      required: false
      default: 30
      example: 60
      selector:
        select:
          options:
            - label: "15 minutes"
              value: "15"
            - label: "30 minutes"
              value: "30"
            - label: "45 minutes"
              value: "45"
            - label: "1 hour"
              value: "60"
            - label: "1 hour 15 min"
              value: "75"
            - label: "1 hour 30 min"
              value: "90"
            - label: "1 hour 45 min"
              value: "105"
            - label: "2 hours"
              value: "120"

force_charge:
  name: Force Charge
  description: Force battery charge mode - switches to autonomous with free import tariff to maximise charging from grid
  fields:
    duration:
      name: Duration
      description: Duration in minutes (15, 30, 45, 60, 75, 90, 105, or 120)
      required: false
      default: 30
      example: 60
      selector:
        select:
          options:
            - label: "15 minutes"
              value: "15"
            - label: "30 minutes"
              value: "30"
            - label: "45 minutes"
              value: "45"
            - label: "1 hour"
              value: "60"
            - label: "1 hour 15 min"
              value: "75"
            - label: "1 hour 30 min"
              value: "90"
            - label: "1 hour 45 min"
              value: "105"
            - label: "2 hours"
              value: "120"

restore_normal:
  name: Restore Normal
  description: Restore normal operation - restores saved tariff or triggers Amber sync for Amber users
  fields: {}

set_backup_reserve:
  name: Set Backup Reserve
  description: Set the battery backup reserve percentage (0-100%). Supports both Tesla Powerwall and SigEnergy systems.
  fields:
    percent:
      name: Percent
      description: Backup reserve percentage
      required: true
      example: 20
      selector:
        number:
          min: 0
          max: 100
          step: 1
          unit_of_measurement: "%"

set_operation_mode:
  name: Set Operation Mode
  description: Set Powerwall operation mode (Time-Based Control or Self-Consumption)
  fields:
    mode:
      name: Mode
      description: Operation mode
      required: true
      example: "autonomous"
      selector:
        select:
          options:
            - label: "Time-Based Control (TOU)"
              value: "autonomous"
            - label: "Self-Consumption"
              value: "self_consumption"

set_grid_export:
  name: Set Grid Export
  description: Set grid export rule (controls when battery can export to grid)
  fields:
    rule:
      name: Export Rule
      description: Grid export rule
      required: true
      example: "pv_only"
      selector:
        select:
          options:
            - label: "Never"
              value: "never"
            - label: "Solar Only"
              value: "pv_only"
            - label: "Solar + Battery"
              value: "battery_ok"

set_grid_charging:
  name: Set Grid Charging
  description: Enable or disable grid charging (allow battery to charge from grid)
  fields:
    enabled:
      name: Enabled
      description: Enable grid charging
      required: true
      example: true
      selector:
        boolean:

get_calendar_history:
  name: Get Calendar History
  description: Fetch energy history from Tesla API for mobile app energy summaries
  fields:
    period:
      name: Period
      description: Time period for history (day, week, month, year)
      required: false
      default: "day"
      example: "week"
      selector:
        select:
          options:
            - label: "Day"
              value: "day"
            - label: "Week"
              value: "week"
            - label: "Month"
              value: "month"
            - label: "Year"
              value: "year"

sync_battery_health:
  name: Sync Battery Health
  description: Receive battery health data from mobile app TEDAPI scan and update sensors
  fields:
    original_capacity_wh:
      name: Original Capacity (Wh)
      description: Original battery capacity in Wh when new
      required: true
      example: 40500
      selector:
        number:
          min: 0
          max: 500000
          unit_of_measurement: Wh
    current_capacity_wh:
      name: Current Capacity (Wh)
      description: Current battery capacity in Wh
      required: true
      example: 38475
      selector:
        number:
          min: 0
          max: 500000
          unit_of_measurement: Wh
    degradation_percent:
      name: Degradation Percent
      description: Battery degradation percentage
      required: true
      example: 5.0
      selector:
        number:
          min: 0
          max: 100
          step: 0.1
          unit_of_measurement: "%"
    battery_count:
      name: Battery Count
      description: Number of Powerwall units
      required: false
      default: 1
      example: 2
      selector:
        number:
          min: 1
          max: 20
    scanned_at:
      name: Scanned At
      description: ISO timestamp of when the scan was performed
      required: false
      example: "2024-12-23T10:30:00Z"
      selector:
        text:
